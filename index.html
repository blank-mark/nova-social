<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Firebase Messenger ‚Äî Google Sign-in (Demo)</title>
  <style>
    body{font-family: Inter, system-ui, sans-serif;margin:0;background:#f6f7fb;color:#111}
    header{background:#334155;color:#fff;padding:12px 16px;display:flex;align-items:center;justify-content:space-between}
    main{padding:16px;max-width:980px;margin:20px auto}
    .card{background:#fff;padding:12px;border-radius:10px;box-shadow:0 6px 18px rgba(20,20,40,0.06);}
    .row{display:flex;gap:10px;align-items:center}
    #loginBtn{padding:8px 12px;border-radius:8px;border:none;background:#1f2937;color:#fff;cursor:pointer}
    #signOut{background:transparent;border:1px solid rgba(255,255,255,0.2);color:#fff;padding:6px 10px;border-radius:6px}
    #usersList{max-height:220px;overflow:auto;margin-top:8px}
    #chat{display:flex;gap:12px;margin-top:12px}
    #convoList{width:260px}
    #messages{flex:1;display:flex;flex-direction:column;height:420px}
    #msgs{flex:1;overflow:auto;padding:8px}
    .msg{margin:6px 0;padding:8px;border-radius:10px;max-width:70%}
    .me{align-self:flex-end;background:#e2f0ff}
    .other{align-self:flex-start;background:#f0f4f8}
    #composer{display:flex;gap:8px;padding:8px}
    input, button{font-size:14px}
  </style>
</head>
<body>
  <header>
    <div>Firebase Messenger ‚Äî –¥–µ–º–æ (—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è Google)</div>
    <div id="userArea"><button id="loginBtn">–í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Google</button></div>
  </header>

  <main>
    <section class="card">
      <h3>–ö–æ—Ä–æ—Ç–∫–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è</h3>
      <ol>
        <li>–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —ç—Ç–æ—Ç —Ñ–∞–π–ª –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π GitHub Pages.</li>
        <li>–í—Å—Ç–∞–≤—å—Ç–µ –≤–∞—à <code>firebaseConfig</code> –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é <code>FIREBASE_CONFIG</code> (—Å—Ç—Ä–æ–∫–∏ –Ω–∏–∂–µ).</li>
        <li>–†–∞–∑–≤–µ—Ä–Ω–∏—Ç–µ –ø—Ä–∞–≤–∏–ª–∞ Firestore / Storage –∏ –∏–Ω–¥–µ–∫—Å (–≤–Ω–∏–∑—É —Ñ–∞–π–ª–∞ ‚Äî –ø–æ–º–µ—á–µ–Ω–æ).</li>
        <li>–ü—Ä–∏ –ø–µ—Ä–≤–æ–º –≤—Ö–æ–¥–µ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã–π <em>username</em>.</li>
      </ol>
      <p>–í–Ω–∏–∑—É ‚Äî –≥–æ—Ç–æ–≤—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ —Ñ–∞–π–ª –∏–Ω–¥–µ–∫—Å–æ–≤ –¥–ª—è Firestore.</p>
    </section>

    <section class="card" style="margin-top:12px">
      <div id="setupArea">
        <div id="chooseUsername" style="display:none">
          <p>–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ—Ä–æ—Ç–∫–∏–π –ª–æ–≥–∏–Ω (–ª–∞—Ç–∏–Ω–∏—Ü–∞, —Ü–∏—Ñ—Ä—ã, _ , -): <input id="usernameInput" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä: mark12"/> <button id="saveUsername">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button></p>
          <div id="usernameMsg"></div>
        </div>

        <div id="appUI" style="display:none">
          <div class="row">
            <input id="searchUser" placeholder="–ù–∞–π—Ç–∏ –ø–æ username" /> <button id="searchBtn">–ü–æ–∏—Å–∫</button>
          </div>
          <div id="usersList"></div>
          <div id="chat">
            <div id="convoList" class="card">
              <h4>–ë–µ—Å–µ–¥—ã</h4>
              <div id="convos"></div>
            </div>
            <div class="card" style="flex:1">
              <div id="messages">
                <div id="msgs"></div>
                <div id="composer">
                  <input id="messageInput" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ" style="flex:1" />
                  <input type="file" id="imageInput" accept="image/*"/>
                  <select id="stickerSelect">
                    <option value="">–°—Ç–∏–∫–µ—Ä</option>
                    <option value="sticker1">üò∫</option>
                    <option value="sticker2">üéµ</option>
                    <option value="sticker3">üî•</option>
                  </select>
                  <button id="sendBtn">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
                </div>
              </div>
            </div>
          </div>
        </div>

      </div>
    </section>

  </main>

  <script type="module">
    // --- –í–ê–ñ–ù–û: –ó–∞–º–µ–Ω–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ FIREBASE_CONFIG –Ω–∏–∂–µ –Ω–∞ –≤–∞—à –∫–æ–Ω—Ñ–∏–≥ –∏–∑ Firebase Console ---
    const FIREBASE_CONFIG = {
      apiKey: "AIzaSyC54igVqsMXIRriBZwiq1w6knBTnkfKIe4",
      authDomain: "nova-prospect-chat.firebaseapp.com",
      projectId: "nova-prospect-chat",
      storageBucket: "nova-prospect-chat.firebasestorage.app",
      messagingSenderId: "256806164650",
      appId: "1:256806164650:web:dd8faf7b8f11b68001d8d3",
      measurementId: "G-9V0Q2E2FNB"
    };

    // –ò–º–ø–æ—Ä—Ç –º–æ–¥—É–ª–µ–π Firebase (CDN)
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js';
    import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js';
    import { getFirestore, doc, setDoc, getDoc, collection, query, where, getDocs, addDoc, serverTimestamp, orderBy, limit, onSnapshot, writeBatch } from 'https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js';
    import { getStorage, ref as sRef, uploadBytes, getDownloadURL } from 'https://www.gstatic.com/firebasejs/9.22.2/firebase-storage.js';

    const app = initializeApp(FIREBASE_CONFIG);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const storage = getStorage(app);

    // UI elements
    const loginBtn = document.getElementById('loginBtn');
    const userArea = document.getElementById('userArea');
    const chooseUsername = document.getElementById('chooseUsername');
    const usernameInput = document.getElementById('usernameInput');
    const saveUsername = document.getElementById('saveUsername');
    const usernameMsg = document.getElementById('usernameMsg');
    const appUI = document.getElementById('appUI');
    const searchUser = document.getElementById('searchUser');
    const searchBtn = document.getElementById('searchBtn');
    const usersList = document.getElementById('usersList');
    const convosDiv = document.getElementById('convos');
    const msgsDiv = document.getElementById('msgs');
    const messageInput = document.getElementById('messageInput');
    const sendBtn = document.getElementById('sendBtn');
    const imageInput = document.getElementById('imageInput');
    const stickerSelect = document.getElementById('stickerSelect');

    let currentUser = null;
    let currentConvoId = null;
    let messagesUnsub = null;

    // Auth
    loginBtn.addEventListener('click', async ()=>{
      const provider = new GoogleAuthProvider();
      try{ await signInWithPopup(auth, provider); }catch(e){alert('–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞: '+e.message)}
    });

    onAuthStateChanged(auth, async user=>{
      currentUser = user;
      if(user){
        userArea.innerHTML = `–ü—Ä–∏–≤–µ—Ç, ${user.displayName} <button id="signOut">–í—ã–π—Ç–∏</button>`;
        document.getElementById('signOut').addEventListener('click', ()=>signOut(auth));

        // –ü—Ä–æ–≤–µ—Ä–∏–º –µ—Å—Ç—å –ª–∏ –ø—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        const uDoc = await getDoc(doc(db,'users',user.uid));
        if(!uDoc.exists()){
          // ask for username
          chooseUsername.style.display = 'block';
          appUI.style.display = 'none';
        } else {
          chooseUsername.style.display = 'none';
          appUI.style.display = 'block';
          initApp();
        }
      } else {
        userArea.innerHTML = `<button id="loginBtn">–í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Google</button>`;
        document.getElementById('loginBtn').addEventListener('click', async ()=>{ const provider = new GoogleAuthProvider(); await signInWithPopup(auth, provider); });
        chooseUsername.style.display = 'none';
        appUI.style.display = 'none';
      }
    });

    // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ username: —Å–æ–∑–¥–∞—ë–º user doc –∏ document /usernames/{username} —á—Ç–æ–±—ã –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å
    saveUsername.addEventListener('click', async ()=>{
      const username = usernameInput.value.trim().toLowerCase();
      if(!/^[a-z0-9_-]{3,20}$/.test(username)){ usernameMsg.textContent = '–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç username (3-20 —Å–∏–º–≤–æ–ª–æ–≤: a-z0-9_-).'; return; }
      try{
        // –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é —Å —Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∏–º–µ–Ω–∏: –∑–¥–µ—Å—å –¥–µ–ª–∞–µ–º –ø—Ä–æ—Å—Ç—É—é –ø—Ä–æ–≤–µ—Ä–∫—É existence
        const unameDocRef = doc(db,'usernames',username);
        const uDocRef = doc(db,'users',currentUser.uid);
        // –ü—Ä–æ–≤–µ—Ä–∏–º –≤—Ä—É—á–Ω—É—é, –∑–∞—Ç–µ–º –ø–æ–ø—Ä–æ–±—É–µ–º —Å–æ–∑–¥–∞—Ç—å (–ø—Ä–∞–≤–∏–ª–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∑–∞–ø—Ä–µ—Ç—è—Ç –¥—É–±–ª—å)
        const check = await getDoc(unameDocRef);
        if(check.exists()){ usernameMsg.textContent = '–≠—Ç–æ –∏–º—è —É–∂–µ –∑–∞–Ω—è—Ç–æ.'; return; }
        // —Å–æ–∑–¥–∞—ë–º –æ–±–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞
        await setDoc(unameDocRef, { uid: currentUser.uid, createdAt: serverTimestamp() });
        await setDoc(uDocRef, { uid: currentUser.uid, displayName: currentUser.displayName, email: currentUser.email, username, photoURL: currentUser.photoURL, createdAt: serverTimestamp() });
        usernameMsg.textContent = '–ì–æ—Ç–æ–≤–æ ‚Äî –∏–º—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ.';
        chooseUsername.style.display = 'none';
        appUI.style.display = 'block';
        initApp();
      }catch(e){ console.error(e); usernameMsg.textContent = '–û—à–∏–±–∫–∞: '+e.message }
    });

    // –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ username
    searchBtn.addEventListener('click', async ()=>{
      usersList.innerHTML = '–ü–æ–∏—Å–∫...';
      const qTxt = searchUser.value.trim().toLowerCase();
      if(!qTxt){ usersList.innerHTML = ''; return; }
      // –ú—ã —Ö—Ä–∞–Ω–∏–º –≤ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ usernames –¥–æ–∫—É–º–µ–Ω—Ç—ã —Å id=username, –ø–æ—ç—Ç–æ–º—É –º–æ–∂–Ω–æ –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –ø—Ä—è–º –ø–æ–ª—É—á–∏—Ç—å doc
      try{
        const unameDoc = await getDoc(doc(db,'usernames',qTxt));
        if(!unameDoc.exists()){ usersList.innerHTML = '–ù–µ –Ω–∞–π–¥–µ–Ω–æ'; return; }
        const uid = unameDoc.data().uid;
        const u = await getDoc(doc(db,'users',uid));
        if(!u.exists()){ usersList.innerHTML = '–ù–µ –Ω–∞–π–¥–µ–Ω–æ'; return; }
        usersList.innerHTML = '';
        const div = document.createElement('div');
        div.innerHTML = `<strong>${u.data().username}</strong> ‚Äî ${u.data().displayName} <button data-uid="${uid}" class="addFriend">–î–æ–±–∞–≤–∏—Ç—å –≤ –¥—Ä—É–∑—å—è</button> <button data-uid="${uid}" class="openChat">–û—Ç–∫—Ä—ã—Ç—å —á–∞—Ç</button>`;
        usersList.appendChild(div);
        div.querySelector('.addFriend').addEventListener('click', ()=>addFriend(uid));
        div.querySelector('.openChat').addEventListener('click', ()=>openConversationWith(uid));
      }catch(e){ usersList.innerHTML = '–û—à–∏–±–∫–∞: '+e.message }
    });

    async function addFriend(friendUid){
      if(!currentUser) return;
      if(friendUid === currentUser.uid) return alert('–≠—Ç–æ –≤—ã —Å–∞–º–∏.');
      // —Å–æ–∑–¥–∞—ë–º –ø–æ–¥-–∫–æ–ª–ª–µ–∫—Ü–∏—é friends —É —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
      try{
        await setDoc(doc(db,`users/${currentUser.uid}/friends`,friendUid), { uid: friendUid, createdAt: serverTimestamp() });
        alert('–î—Ä—É–≥ –¥–æ–±–∞–≤–ª–µ–Ω.');
      }catch(e){ alert('–û—à–∏–±–∫–∞: '+e.message) }
    }

    // –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –ø–∞—Ä—ã uid -> convoId (—á—Ç–æ–±—ã –±—ã–ª –æ–¥–∏–Ω —Ä–∞–∑–≥–æ–≤–æ—Ä –Ω–∞ –ø–∞—Ä—É —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤)
    function convoIdFor(uidA, uidB){ return [uidA, uidB].sort().join('_'); }

    async function openConversationWith(otherUid){
      currentConvoId = convoIdFor(currentUser.uid, otherUid);
      // –ø–æ–∫–∞–∑–∞—Ç—å –æ–∫–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–π
      convosDiv.innerHTML = `<div>–†–∞–∑–≥–æ–≤–æ—Ä —Å ${otherUid}</div>`;
      if(messagesUnsub) messagesUnsub();
      // –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è (–≤ –ø—Ä–æ—Å—Ç–æ–º –≤–∏–¥–µ orderBy timestamp)
      const msgsRef = collection(db,'conversations',currentConvoId,'messages');
      const q = query(msgsRef, orderBy('timestamp'));
      messagesUnsub = onSnapshot(q, snap=>{
        msgsDiv.innerHTML = '';
        snap.forEach(docSnap=>{
          const m = docSnap.data();
          const el = document.createElement('div'); el.className = 'msg '+(m.sender===currentUser.uid? 'me':'other');
          if(m.type === 'text') el.textContent = m.text;
          else if(m.type === 'image') el.innerHTML = `<img src="${m.url}" style="max-width:260px;border-radius:8px"/>`;
          else if(m.type === 'sticker') el.textContent = '–°–¢–ò–ö–ï–†: '+m.sticker;
          msgsDiv.appendChild(el);
        });
        msgsDiv.scrollTop = msgsDiv.scrollHeight;
      });
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–ø–æ–¥–≥—Ä—É–∑–∫–∞ –±–µ—Å–µ–¥ –∏ —Ç.–¥.)
    function initApp(){
      // –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã—Ö –¥—Ä—É–∑–µ–π/–±–µ—Å–µ–¥—ã: –∑–¥–µ—Å—å –ø—Ä–æ—Å—Ç–æ–π –ø—Ä–∏–º–µ—Ä ‚Äî —Å–ø–∏—Å–æ–∫ –¥—Ä—É–∑–µ–π
      // –î–ª—è demo –ø—Ä–æ—Å—Ç–æ –ø–æ–∫–∞–∂–µ–º ¬´–ú–æ–∏ –±–µ—Å–µ–¥—ã¬ª –ø–æ user subcollections (–≤ –ø—Ä–æ–¥–µ –Ω—É–∂–Ω–æ –æ—Ç–¥–µ–ª—å–Ω—É—é –∫–æ–ª–ª–µ–∫—Ü–∏—é conversations)
      // TODO: —Å–ø–∏—Å–∫–∏ –±–µ—Å–µ–¥ ‚Äî –º–æ–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å –∫–æ–ª–ª–µ–∫—Ü–∏–µ–π conversations
      convosDiv.innerHTML = '<p>–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –æ—Ç–∫—Ä–æ–π—Ç–µ —á–∞—Ç</p>';
    }

    // –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π (—Ç–µ–∫—Å—Ç/—Ñ–æ—Ç–æ/—Å—Ç–∏–∫–µ—Ä)
    sendBtn.addEventListener('click', async ()=>{
      if(!currentConvoId) return alert('–û—Ç–∫—Ä–æ–π—Ç–µ —á–∞—Ç');
      const text = messageInput.value.trim();
      const sticker = stickerSelect.value;
      const file = imageInput.files[0];
      try{
        const msgsRef = collection(db,'conversations',currentConvoId,'messages');
        if(file){
          const path = `images/${currentUser.uid}/${Date.now()}_${file.name}`;
          const storageRef = sRef(storage,path);
          const snap = await uploadBytes(storageRef, file);
          const url = await getDownloadURL(storageRef);
          await addDoc(msgsRef, { sender: currentUser.uid, type:'image', url, timestamp: serverTimestamp() });
        } else if(sticker){
          await addDoc(msgsRef, { sender: currentUser.uid, type:'sticker', sticker, timestamp: serverTimestamp() });
        } else if(text){
          await addDoc(msgsRef, { sender: currentUser.uid, type:'text', text, timestamp: serverTimestamp() });
        }
        messageInput.value = '';
        imageInput.value = '';
        stickerSelect.value = '';
      }catch(e){ alert('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏: '+e.message) }
    });

    // –ú–∞–ª–µ–Ω—å–∫–∞—è –ø–æ–¥—Å–∫–∞–∑–∫–∞: –ø—Ä–æ—Å—Ç—ã–µ —Å—Ç–∏–∫–µ—Ä—ã (–≤ –ø—Ä–æ–¥–µ —Ö—Ä–∞–Ω–∏—Ç—å –≤ storage –∏ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å preview)
  </script>

  <!--
    --- FIRESTORE RULES (—Å–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤ Firebase Console -> Firestore -> Rules) ---

    // firestore.rules
    rules_version = '2';
    service cloud.firestore {
      match /databases/{database}/documents {

        // usernames collection: allow create only if not exists and owner is auth.uid
        match /usernames/{username} {
          allow create: if request.auth != null && request.resource.data.uid == request.auth.uid && !exists(/databases/$(database)/documents/usernames/$(username));
          allow read: if true;
          allow delete: if false; // –Ω–µ –¥–∞—ë–º —É–¥–∞–ª—è—Ç—å –∏–∑ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        }

        // users collection: only owner can write their document
        match /users/{userId} {
          allow read: if true;
          allow create: if request.auth != null && request.auth.uid == userId;
          allow update, delete: if request.auth != null && request.auth.uid == userId;

          // friends subcollection
          match /friends/{friendId} {
            allow read: if request.auth != null && request.auth.uid == userId;
            allow create: if request.auth != null && request.auth.uid == userId;
            allow delete: if request.auth != null && request.auth.uid == userId;
          }
        }

        // conversations/{convoId}/messages/{msgId} - only participants can read/write
        match /conversations/{convoId}/messages/{msgId} {
          allow read: if request.auth != null && isParticipant(convoId, request.auth.uid);
          allow create: if request.auth != null && isParticipant(convoId, request.auth.uid) && request.resource.data.sender == request.auth.uid && (request.resource.data.type in ['text','image','sticker']) && request.resource.data.timestamp == request.time;
          allow delete, update: if false;
        }

        function isParticipant(convoId, uid){
          // –ü—Ä–∏–Ω–∏–º–∞–µ–º, —á—Ç–æ convoId ‚Äî —ç—Ç–æ –¥–≤–∞ uid, –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ '_'
          return convoId.split('_').hasAny([uid]);
        }
      }
    }

    NOTE: security rules –Ω–µ –¥–∞—é—Ç 100% –∑–∞—â–∏—Ç—ã –æ—Ç –≤—Å–µ—Ö –∞—Ç–∞–∫ (–ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ), –Ω–æ —ç—Ç–æ –Ω–∞—á–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è.

    --- STORAGE RULES (–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤ Firebase Console -> Storage -> Rules) ---

    // storage.rules
    rules_version = '2';
    service firebase.storage {
      match /b/{bucket}/o {
        match /images/{userId}/{allPaths=**} {
          allow read: if true;
          allow write: if request.auth != null && request.auth.uid == userId;
        }
      }
    }

    --- firestore.indexes.json (–µ—Å–ª–∏ –Ω—É–∂–µ–Ω –∫–æ–º–ø–æ–∑–∏—Ç–Ω—ã–π –∏–Ω–¥–µ–∫—Å) ---
    {
      "indexes": [
        {
          "collectionGroup": "messages",
          "queryScope": "COLLECTION",
          "fields": [
            { "fieldPath": "timestamp", "order": "ASCENDING" }
          ]
        }
      ],
      "fieldOverrides": []
    }
  -->

</body>
</html>
